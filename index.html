<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Farm lol</title>
<style>
  :root{ --bg:#e1f5d3; --card:#ffffffcc; --muted:#5f6f52; --accent:#4caf50; }
  *{box-sizing:border-box}
  
  /* === ÄÃƒ CHá»ˆNH Sá»¬A: BODY dÃ¹ng flex Ä‘á»ƒ cÄƒn giá»¯a wrapper trÃªn má»i mÃ n hÃ¬nh === */
  body{ 
    margin:0; 
    font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;
    background: var(--bg);
    color:#2b3a1f; 
    min-height:100vh; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    /* ÄÃ£ loáº¡i bá» 'overflow: hidden;' Ä‘á»ƒ trÃ¡nh cáº¯t ná»™i dung trÃªn mÃ n hÃ¬nh lá»›n */
  }

  /* === ÄÃƒ CHá»ˆNH Sá»¬A: Wrapper Ä‘á»ƒ giá»›i háº¡n kÃ­ch thÆ°á»›c thiáº¿t káº¿ vÃ  sáºµn sÃ ng cho SCALE === */
  .app-wrapper {
    /* KÃ­ch thÆ°á»›c thiáº¿t káº¿ cá»‘ Ä‘á»‹nh (Mobile Vertical - 400x750) */
    width: 400px; 
    height: 750px; 
    margin: 0; 
    background: var(--bg);
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 10px rgba(0,0,0,0.1); 
    position: relative; 
    text-align: left; 

    /* === QUAN TRá»ŒNG: Thiáº¿t láº­p SCALE === */
    transform-origin: top center; /* Äiá»ƒm neo Ä‘á»ƒ scale */
    transform: scale(1); 
    transition: transform 0.1s ease-out;
    flex-shrink: 0;
  }
  /* === Káº¾T THÃšC CHá»ˆNH Sá»¬A WRAPPER === */

  header{ display:flex; align-items:center; justify-content:space-between;
          padding:16px 20px; border-bottom:1px solid rgba(0,0,0,0.07);
          backdrop-filter:blur(6px); background:#ffffff88; white-space:nowrap; 
          z-index: 20; 
        }
  
  main{ flex:1; display:flex; justify-content:center; 
        align-items:flex-start; 
        padding:0; 
        overflow: hidden;
        position: relative;
  }
  main > div {
    display: none; 
  }
  
  /* THÃŠM CSS CHO áº¢NH Ná»€N */
  #beanstalk-bg {
    position: absolute; 
    top: 0; 
    left: 50%; 
    transform: translateX(-50%); 
    width: 100%; 
    height: auto;
    z-index: 1; 
    max-height: 100%; 
    object-fit: cover; 
  }

  /* THÃŠM CSS CHO BÃ“NG ÄÃˆN */
  #light-bulb {
      position: absolute;
      top: 8px; 
      left: 30%; 
      transform: translateX(-50%);
      width: 60px; 
      height: auto;
      z-index: 8; 
      cursor: pointer; 
  }

  /* CÃ‚N Äáº¨U VÃ‚N (Slot 0) */
  #kinto-cloud {
      position: absolute; 
      top: 50px; 
      left: 60%; 
      transform: translateX(-50%); 
      width: 80px; 
      height: 80px; 
      z-index: 10; 
      cursor: pointer; 
      transition: transform 0.1s, box-shadow 0.1s; 
  }

  /* THÃŠM CSS CHO Ã” Äáº¶T CHáº¬U */
  #pot-container {
      position: absolute;
      top: 0; 
      left: 50%;
      transform: translateX(-50%);
      width: 100%; 
      height: 100%; 
      z-index: 5; 
      display: flex;
      justify-content: center;
      pointer-events: none; 
  }

  .pot-slot {
      position: absolute;
      width: 50px; 
      height: 50px; 
      background: transparent; 
      border: none; 
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1em; 
      color: white; 
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.1s;
      pointer-events: auto; 
  }

  .pot-slot img {
      width: 120%; 
      height: 120%; 
      object-fit: contain;
      position: absolute; 
      top: -10px; 
      left: -10px;
  }

  #slot-1 img {
      width: 150%; 
      height: 150%; 
      top: -30px; 
      left: -20px; 
  }
  
  #slot-6 img {
      width: 200%; 
      height: 200%; 
      top: -50px; 
      left: -25px; 
  }

  /* Äá»ŠNH Vá»Š CHO CÃC SLOT (ÄÃ£ chá»‰nh sá»­a top +15px tá»•ng cá»™ng) */
  #slot-1 { top: 180px; left: calc(50% - 150px + 20px); } 
  #slot-2 { top: 180px; left: calc(50% - 90px + 10px); }  
  #slot-3 { top: 180px; left: calc(50% - 30px + 10px); }   
  /* ÄÃƒ Sá»¬A: Dá»‹ch chuyá»ƒn xuá»‘ng thÃªm 10px (400px -> 410px) */
  /* === ÄÃƒ CHá»ˆNH Sá»¬A: ThÃªm 15px sang pháº£i theo yÃªu cáº§u === */
  #slot-6 { top: 410px; left: calc(50% - 30px + 10px + 15px); }
  #slot-4 { top: 180px; left: calc(50% + 30px + 10px); }  
  #slot-5 { top: 180px; left: calc(50% + 90px + 10px); } 
  
  #slot-2, #slot-3, #slot-4, #slot-5, #slot-1, #slot-6 {
      background: transparent; 
      border: none;          
  }

  /* POPUPs cáº§n Ä‘Æ°á»£c Ä‘áº·t cá»‘ Ä‘á»‹nh tÆ°Æ¡ng Ä‘á»‘i vá»›i mÃ n hÃ¬nh tháº­t */
  #exp-popup, #equip-box, #shop-box, #online-box { 
    position:fixed; 
    top:50%; 
    left:50%; 
    transform:translate(-50%, -50%); 
    background:white; 
    padding:20px; 
    border-radius:12px; 
    box-shadow:0 4px 18px rgba(0,0,0,0.25); 
    display:none; 
    z-index:999; 
    text-align:center; 
    min-width:240px; 
  }
  
</style>
</head>
<body>
<div class="app-wrapper"> 

<header>
  <div class="brand"><div style="font-weight:700">ğŸŒ¾ Farm LOL ğŸŒ¾</div></div>
  <div class="controls">
    <button id="btn-new">ğŸ†• Táº¡o</button>
    <button id="btn-delete" disabled>ğŸ—‘ï¸ XoÃ¡</button>
    <button id="btn-save" disabled>ğŸ’¾ LÆ°u</button>
  </div>
</header>

<div id="name-box" style="display:none; text-align:center; padding:15px; font-size:22px;">
<div style="font-weight:600; margin-bottom:10px;">Xin chÃ o nÃ´ng dÃ¢n!</div>
TÃªn báº¡n lÃ  gÃ¬?
<input type="text" id="player-name" placeholder="VÃ­ dá»¥: Alice" style="margin:10px 0; padding:8px; border-radius:6px; border:1px solid #ccc; width:80%; max-width:200px;" />
<br>
<button id="btn-next">Tiáº¿p theo &rarr;</button>
</div>

<div id="choose-box" style="display:none; text-align:center; padding:15px; font-size:26px;">
<div style="font-weight:600; margin-bottom:10px;">Chá»n icon nÃ´ng tráº¡i!</div>
<div id="icon-choices" style="display:flex; justify-content:center; gap:15px;">
  <button class="choose-icon" data-icon="ğŸ ">ğŸ </button>
  <button class="choose-icon" data-icon="ğŸ¡">ğŸ¡</button>
  <button class="choose-icon" data-icon="ğŸ°">ğŸ°</button>
</div>
</div>

<div id="equip-box">
<h3>âš’ï¸ Trang bá»‹</h3>
<div style="text-align:left; margin-bottom:10px;">
  <div id="tool-name"></div>
  <div id="tool-desc" style="font-size:0.9em; color:var(--muted);"></div>
</div>
<hr style="border:0; border-top:1px solid #eee; margin:10px 0;" />
<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
  <div>Sá»©c máº¡nh: <span id="tool-pow"></span></div>
  <div>Äá»™ bá»n: <span id="tool-hp"></span></div>
</div>
<button id="btn-equip-close" onclick="equipBox.style.display='none'">ÄÃ³ng</button>
</div>

<div id="shop-box">
<h3>ğŸ’° Cá»­a hÃ ng</h3>
<div style="font-size:0.9em; margin-bottom:10px; color:var(--muted);">
  Xu: <span id="coin-xu">0</span> | USD: <span id="coin-usd">0</span>
</div>
<hr style="border:0; border-top:1px solid #eee; margin:10px 0;" />
<div id="shop-items" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
  </div>
<button onclick="shopBox.style.display='none'" style="margin-top:15px;">ÄÃ³ng</button>
</div>

<div id="online-box">
<h3>ğŸŒ Online</h3>
<div style="margin-bottom:15px;">
  Chá»©c nÄƒng nÃ y hiá»‡n chÆ°a kháº£ dá»¥ng.
</div>
<button onclick="onlineBox.style.display='none'">ÄÃ³ng</button>
</div>

<div id="exp-popup">
  <h3>ğŸ“Š Kinh nghiá»‡m</h3>
  <div id="exp-text"></div>
  <br>
  <button onclick="expPopup.style.display='none'">ÄÃ³ng</button>
</div>

<main>
  <img id="beanstalk-bg" src="1000000683.jpg" alt="CÃ¢y Ä‘áº­u tháº§n" />
  
  <img id="light-bulb" src="bongdensoidot.png" alt="BÃ³ng Ä‘Ã¨n sá»£i Ä‘á»‘t" />
  <div id="pot-container">
    <div class="pot-slot" id="slot-1" data-slot="1">
        <img src="1763444144946.png" alt="NhÃ¢n váº­t Ä‘en-Ä‘á»" />
    </div>
    
    <div class="pot-slot" id="slot-2" data-slot="2">
        <img src="1763442967614.png" alt="Cháº­u Ä‘áº¥t" />
    </div>
    <div class="pot-slot" id="slot-3" data-slot="3">
        <img src="1763442967614.png" alt="Cháº­u Ä‘áº¥t" />
    </div>
    
    <div class="pot-slot" id="slot-6" data-slot="6">
        <img src="1000000688.png" alt="NhÃ¢n váº­t ngá»“i cáº§m bÃ¡t" />
    </div>
    <div class="pot-slot" id="slot-4" data-slot="4">
        <img src="1763442967614.png" alt="Cháº­u Ä‘áº¥t" />
    </div>
    <div class="pot-slot" id="slot-5" data-slot="5">
        <img src="1763442967614.png" alt="Cháº­u Ä‘áº¥t" />
    </div>
    </div>
  
  <img id="kinto-cloud" src="candauvan.png" alt="CÃ¢n Äáº©u VÃ¢n" data-slot="0" />
  
  <div>
    </div>
</main>

</div> 

<script>
// ==== Biáº¿n Tráº¡ng thÃ¡i TrÃ² chÆ¡i ==== //
let playerName = "NÃ´ng dÃ¢n";
let farmIcon = "ğŸŒ¾";
let level = 0;
let exp = 0;
let xu = 0;
let usd = 0;
let tool = { name: "Xáº»ng Gá»—", power: 1, maxHP: 100, currentHP: 100 };
let shopItems = [
  { id: 1, name: "GÃ³i Xu Nhá»", price: 1, currency: "usd", type: "currency", value: 100 },
  { id: 2, name: "BÃºa Sáº¯t", price: 500, currency: "xu", type: "tool", value: { name: "BÃºa Sáº¯t", power: 3, maxHP: 250, currentHP: 250 } },
];
let farmSlots = Array(5).fill(null); // 5 Ã´ trá»“ng cÃ¢y

// ==== Biáº¿n DOM ==== //
const btnNew = document.getElementById("btn-new");
const btnDelete = document.getElementById("btn-delete"); 
const btnSave = document.getElementById("btn-save");     
const nameBox = document.getElementById("name-box");
const chooseBox = document.getElementById("choose-box");
const btnNext = document.getElementById("btn-next");
const nameInput = document.getElementById("player-name");
const chooseIcons = document.querySelectorAll(".choose-icon");
const expFill = document.getElementById("exp-fill");
const shopBox = document.getElementById("shop-box");
const coinXu = document.getElementById("coin-xu");
const coinUSD = document.getElementById("coin-usd");
const expText = document.getElementById("exp-text");
const expPopup = document.getElementById("exp-popup");
const onlineBox = document.getElementById("online-box");
const shopItemsContainer = document.getElementById("shop-items");
const equipBox = document.getElementById("equip-box");

// ==== HÃ€M LOGIC CHÃNH ==== //
function expNeeded(lv){ return lv * 100; }

function updateDisplay(){
  // Kiá»ƒm tra tá»“n táº¡i vÃ  cáº­p nháº­t EXP bar (náº¿u cÃ³)
  const expBar = document.querySelector("#exp-bar");
  if(level > 0 && expBar){
      expBar.style.width = (exp / expNeeded(level)) * 100 + "%";
  }

  // Cáº­p nháº­t tiá»n tá»‡
  if (coinXu) coinXu.textContent = xu.toLocaleString('vi-VN');
  if (coinUSD) coinUSD.textContent = usd.toLocaleString('vi-VN');
}

function updateShop(){
  if(!shopItemsContainer) return;
  shopItemsContainer.innerHTML = "";
  shopItems.forEach(item => {
    const itemDiv = document.createElement("div");
    itemDiv.className = "shop-item";
    itemDiv.style.border = "1px solid var(--muted)";
    itemDiv.style.borderRadius = "8px";
    itemDiv.style.padding = "10px";
    itemDiv.style.textAlign = "center";
    itemDiv.innerHTML = `
      <div style="font-weight:600;">${item.name}</div>
      <div style="font-size:0.9em; margin:5px 0;">${item.currency === "xu" ? 'Xu' : 'USD'}: ${item.price}</div>
      <button class="btn-buy" data-id="${item.id}" style="padding:5px 10px; border:none; border-radius:5px; background:var(--accent); color:white; cursor:pointer;">
        Mua
      </button>
    `;
    shopItemsContainer.appendChild(itemDiv);
  });
  
  // Gáº¯n sá»± kiá»‡n mua hÃ ng
  document.querySelectorAll(".btn-buy").forEach(btn => {
    btn.addEventListener("click", handleBuy);
  });
}

function updateControlButtons(){
  const hasGame = level > 0;
  btnNew.disabled = hasGame;
  btnDelete.disabled = !hasGame;
  btnSave.disabled = !hasGame;
}

function handleBuy(event) {
  const itemId = parseInt(event.target.getAttribute("data-id"));
  const item = shopItems.find(i => i.id === itemId);
  if (!item) return;

  let canBuy = false;
  if (item.currency === "xu" && xu >= item.price) {
    xu -= item.price;
    canBuy = true;
  } else if (item.currency === "usd" && usd >= item.price) {
    usd -= item.price;
    canBuy = true;
  }

  if (canBuy) {
    if (item.type === "currency") {
      if (item.currency === "usd") {
        xu += item.value;
        alert(`Báº¡n Ä‘Ã£ mua thÃ nh cÃ´ng ${item.name}! Nháº­n ${item.value} Xu.`);
      }
    } else if (item.type === "tool") {
      tool = item.value;
      alert(`Báº¡n Ä‘Ã£ trang bá»‹ ${item.name}!`);
    }
    updateDisplay();
    updateShop(); // Cáº­p nháº­t láº¡i cá»­a hÃ ng sau khi mua
  } else {
    alert("KhÃ´ng Ä‘á»§ tiá»n!");
  }
}

// HÃ m Xá»­ lÃ½ Táº¡o game má»›i
function handleNewGame(){
    nameBox.style.display = 'block';
}

btnNew.addEventListener('click', handleNewGame);

btnNext.addEventListener('click', () => {
    playerName = nameInput.value || "NÃ´ng dÃ¢n";
    nameBox.style.display = 'none';
    chooseBox.style.display = 'block';
});

chooseIcons.forEach(btn => {
    btn.addEventListener('click', (e) => {
        farmIcon = e.target.getAttribute('data-icon');
        // Khá»Ÿi táº¡o game
        level = 1;
        exp = 0;
        xu = 100; // Tiá»n khá»Ÿi táº¡o
        usd = 1;  // Tiá»n khá»Ÿi táº¡o
        
        chooseBox.style.display = 'none';
        
        // ThÃªm thÃ´ng bÃ¡o
        alert(`ChÃ o má»«ng ${playerName} (${farmIcon}) Ä‘áº¿n vá»›i Farm LOL!`);
        
        updateDisplay();
        updateControlButtons();
        saveGame();
    });
});

// HÃ m Táº£i game
function loadGame(){
    const savedGame = localStorage.getItem('farmLolGame');
    if(savedGame){
        const gameData = JSON.parse(savedGame);
        playerName = gameData.playerName;
        farmIcon = gameData.farmIcon;
        level = gameData.level;
        exp = gameData.exp;
        xu = gameData.xu;
        usd = gameData.usd;
        tool = gameData.tool;
        farmSlots = gameData.farmSlots;
        
        // ThÃªm thÃ´ng bÃ¡o
        console.log(`ÄÃ£ táº£i game cá»§a ${playerName} (Cáº¥p ${level})`);
    }
}

// HÃ m LÆ°u game
function saveGame(){
    const gameData = { playerName, farmIcon, level, exp, xu, usd, tool, farmSlots };
    localStorage.setItem('farmLolGame', JSON.stringify(gameData));
    alert("ÄÃ£ lÆ°u trÃ² chÆ¡i!");
}
btnSave.addEventListener('click', saveGame);

// HÃ m XÃ³a game
function deleteGame(){
    if(confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a nÃ´ng tráº¡i hiá»‡n táº¡i?")){
        localStorage.removeItem('farmLolGame');
        // Reset biáº¿n tráº¡ng thÃ¡i
        playerName = "NÃ´ng dÃ¢n";
        farmIcon = "ğŸŒ¾";
        level = 0;
        exp = 0;
        xu = 0;
        usd = 0;
        tool = { name: "Xáº»ng Gá»—", power: 1, maxHP: 100, currentHP: 100 };
        farmSlots = Array(5).fill(null);
        
        alert("ÄÃ£ xÃ³a nÃ´ng tráº¡i!");
        updateDisplay();
        updateControlButtons();
    }
}
btnDelete.addEventListener('click', deleteGame);

// === LOGIC CHO CÃC NÃšT CLICK ===

// 1. CÃ‚N Äáº¨U VÃ‚N (Slot 0) - Má»Ÿ Cá»­a hÃ ng
const kintoCloud = document.getElementById("kinto-cloud");
if (kintoCloud) {
    kintoCloud.addEventListener("click", () => {
        if (level === 0) {
            alert("Báº¡n cáº§n táº¡o nÃ´ng tráº¡i trÆ°á»›c! Vui lÃ²ng nháº¥n nÃºt 'ğŸ†• Táº¡o' á»Ÿ trÃªn.");
            return;
        }
        updateShop(); 
        shopBox.style.display = 'block';
    });
}

// 2. BÃ“NG ÄÃˆN Sá»¢I Äá»T - Má»Ÿ Trang bá»‹ (CÃ´ng cá»¥)
const lightBulb = document.getElementById("light-bulb");
if (lightBulb) {
    lightBulb.addEventListener("click", () => {
        if (level === 0) {
            alert("Báº¡n cáº§n táº¡o nÃ´ng tráº¡i trÆ°á»›c! Vui lÃ²ng nháº¥n nÃºt 'ğŸ†• Táº¡o' á»Ÿ trÃªn.");
            return;
        }
        // Cáº­p nháº­t ná»™i dung popup Trang bá»‹
        document.getElementById("tool-name").textContent = tool.name;
        document.getElementById("tool-desc").textContent = "CÃ´ng cá»¥ thu hoáº¡ch cÆ¡ báº£n"; 
        document.getElementById("tool-pow").textContent = tool.power;
        document.getElementById("tool-hp").textContent = `${tool.currentHP}/${tool.maxHP}`;
        
        equipBox.style.display = 'block';
    });
}

// 3. CÃC Ã” CHáº¬U (Slot 1 Ä‘áº¿n Slot 6) - Hiá»‡n popup EXP (Táº¡m thá»i)
const potSlots = document.querySelectorAll(".pot-slot");
potSlots.forEach(slot => {
    slot.addEventListener("click", () => {
        if (level === 0) {
            alert("Báº¡n cáº§n táº¡o nÃ´ng tráº¡i trÆ°á»›c! Vui lÃ²ng nháº¥n nÃºt 'ğŸ†• Táº¡o' á»Ÿ trÃªn.");
            return;
        }
        const slotNum = slot.getAttribute('data-slot');
        expText.innerHTML = `Báº¡n Ä‘Ã£ kiá»ƒm tra **Ã” ${slotNum}**.<br>Chá»©c nÄƒng trá»“ng trá»t/thu hoáº¡ch sáº½ cÃ³ á»Ÿ phiÃªn báº£n tiáº¿p theo!`;
        expPopup.style.display = 'block';
    });
});

// === QUAN TRá»ŒNG: HÃ€M ÄIá»€U CHá»ˆNH SCALE GIAO DIá»†N (ÄÃ£ kháº¯c phá»¥c lá»—i hiá»ƒn thá»‹ trÃªn PC) ===
function adjustAppWrapperScale() {
    const appWrapper = document.querySelector(".app-wrapper");
    if (!appWrapper) return;

    // KÃ­ch thÆ°á»›c thiáº¿t káº¿ cá»‘ Ä‘á»‹nh
    const designWidth = 400; // px
    const designHeight = 750; // px

    // KÃ­ch thÆ°á»›c thá»±c táº¿ cá»§a viewport
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;

    // TÃ­nh toÃ¡n tá»· lá»‡
    const scaleX = viewportWidth / designWidth;
    const scaleY = viewportHeight / designHeight;

    // 1. Chá»n tá»· lá»‡ nhá» hÆ¡n Ä‘á»ƒ Ä‘áº£m báº£o toÃ n bá»™ á»©ng dá»¥ng náº±m vá»«a trong mÃ n hÃ¬nh
    let scale = Math.min(scaleX, scaleY);
    
    // 2. ğŸŒŸ GIá»šI Háº N Tá»¶ Lá»† Tá»I ÄA ğŸŒŸ
    // Äáº£m báº£o giao diá»‡n khÃ´ng bá»‹ phÃ³ng to quÃ¡ má»©c trÃªn mÃ n hÃ¬nh PC lá»›n
    const MAX_SCALE = 1.0; 
    scale = Math.min(scale, MAX_SCALE);
    
    // 3. Ãp dá»¥ng transform scale
    appWrapper.style.transform = `scale(${scale})`;

    // Äiá»u chá»‰nh margin Ä‘á»ƒ cÄƒn giá»¯a theo chiá»u dá»c náº¿u cÃ³ khoáº£ng trá»‘ng
    if (viewportHeight > designHeight * scale) { 
        const scaledHeight = designHeight * scale;
        const marginTop = (viewportHeight - scaledHeight) / 2;
        appWrapper.style.marginTop = `${marginTop}px`;
        appWrapper.style.marginBottom = `${marginTop}px`;
    } else {
        appWrapper.style.marginTop = '0';
        appWrapper.style.marginBottom = '0';
    }
}
// === Káº¾T THÃšC HÃ€M ÄIá»€U CHá»ˆNH SCALE ===


// HÃ m Khá»Ÿi táº¡o/Táº£i game
function initializeGame(){
    loadGame(); // Táº£i dá»¯ liá»‡u tá»« Local Storage
    updateDisplay();
    updateControlButtons();
    adjustAppWrapperScale(); // Cháº¡y hÃ m scale láº§n Ä‘áº§u
}

// Cháº¡y hÃ m khá»Ÿi táº¡o khi trang táº£i xong
window.onload = initializeGame;
// Cháº¡y hÃ m scale má»—i khi cá»­a sá»• thay Ä‘á»•i kÃ­ch thÆ°á»›c
window.addEventListener('resize', adjustAppWrapperScale);
</script>
</body>
</html>
