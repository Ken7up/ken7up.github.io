<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cuá»™c Chiáº¿n Icon</title>
<style>
body{font-family:'Segoe UI',sans-serif;margin:0;padding:16px;background:linear-gradient(135deg,#e0f7fa,#fce4ec);color:#111;}
.header{text-align:center;}
.button{background:#2196f3;border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;margin:4px;}
.small{font-size:13px;color:#444;}
.container{max-width:980px;margin:10px auto;background:rgba(255,255,255,0.85);padding:12px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center;}
#gameArea{text-align:center;margin-bottom:10px;}
.topbar{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;}
.stats{text-align:left;}
.hidden{display:none;}
.barContainer{width:100%;background:#ddd;border-radius:8px;overflow:hidden;height:14px;margin:6px 0; cursor:pointer;} 
.bar{height:100%;transition:width .4s ease;}
.panel{padding:10px;border-radius:10px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-top:10px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;}
.item-row{display:flex;justify-content:space-between;align-items:center;padding:8px 6px;border-bottom:1px dashed #eee;}
.level-badge{background:#222;color:#fff;padding:2px 6px;border-radius:6px;font-size:12px;margin-left:8px;}
.plot{height:80px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.06);}
.plot.empty{background:linear-gradient(160deg,#b27f57,#8f5f3f);color:#fff;}
.plot.growing{background:linear-gradient(160deg,#8e6f4f,#6f8f5f);color:#fff;}
.plot.ready{background:linear-gradient(160deg,#ffd54f,#ffb300);color:#222;}
#log{height:160px;overflow:auto;padding:8px;border-radius:8px;background:#fafafa;border:1px solid #eee;font-size:14px;}
footer{text-align:center;margin-top:12px;font-size:12px;color:#666;}
.rainbow-title {
  font-size: 25px;
  font-weight: bold;
  text-align: center;
  background: linear-gradient(90deg, #ff4081, #ffeb3b, #4caf50, #2196f3, #9c27b0);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbowShift 3s linear infinite;
  margin-bottom: 12px;
  text-shadow: 0 2px 6px rgba(0,0,0,0.25);
}

@keyframes rainbowShift {
  0% { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="rainbow-title">âš”ï¸ Cuá»™c Chiáº¿n Icon âš”ï¸</div>
    <div id="gameArea" class="panel">
      <button class="button" id="createBtn" onclick="createCharacter()">ğŸ†• Táº¡o</button>
      <button class="button hidden" id="deleteBtn" onclick="deleteCharacter()">ğŸ—‘ï¸ XÃ³a</button>
      <button class="button hidden" id="saveBtn" onclick="saveGame()">ğŸ’¾ LÆ°u</button>
      <button class="button" onclick="showPanel('shopPanel')">ğŸª Shop</button>
      <button class="button" onclick="claimDailyReward()">ğŸ Online</button>
    </div>
  </div>

  <div class="topbar">
    <div class="stats panel" style="flex:1;">
      <div id="characterInfo"><em>ChÆ°a cÃ³ nhÃ¢n váº­t</em></div>
<div id="expBarContainer" class="barContainer" onclick="showStatValue('exp')"><div id="expBar" class="bar" style="width:0;background:linear-gradient(90deg,#ffee58,#fdd835);height:10px;"></div></div>
<div id="hpBarContainer" class="barContainer" onclick="showStatValue('hp')"><div id="hpBar" class="bar" style="width:0;background:linear-gradient(90deg,#ff5252,#ff1744);"></div></div>
<div id="mpBarContainer" class="barContainer" onclick="showStatValue('mp')"><div id="mpBar" class="bar" style="width:0;background:linear-gradient(90deg,#42a5f5,#1e88e5);"></div></div>
    </div>
    <div style="width:280px;" class="panel">
      <div id="characterIcon" style="font-size:48px;text-align:center;">â“</div>
      <div id="petIcon" style="font-size:30px;text-align:center;display:none;margin-top:6px;">ğŸ¾</div>
    </div>
  </div>

  <div class="row">
    <button class="button" onclick="startBattle()">ğŸŒ Chá»n Map ğŸŒ</button>
  </div>
  
  <div class="row">
    <button class="button" onclick="showPanel('farmPanel')">ğŸŒ¾ Farm</button>
  </div>
  <div id="farmPanel" class="panel hidden">
    <h3>ğŸŒ¾ NÃ´ng tráº¡i</h3>
    <div id="farmArea" class="grid"></div>
    <div style="margin-top:8px;">
      <button class="button" onclick="buySeed()">ğŸ«˜ Mua háº¡t (ğŸ’¸ USD: 10)</button>
      <button class="button" onclick="buyPlot()">ğŸª™ Mua Ã´ Ä‘áº¥t</button>
    </div>
    <div style="text-align:center;margin-top:8px;"><button class="button" onclick="showPanel('')">ÄÃ³ng</button></div>
  </div>
  <div id="mainPanels">
    <div id="inventoryPanel" class="panel hidden">
  <h3>ğŸ’ TÃºi Ä‘á»“</h3>
  <div style="text-align:center;margin-bottom:8px;">ğŸª™ Xu: <span id="goldDisplay"></span> | ğŸ’¸ USD: <span id="diamondDisplay"></span></div>
  <div id="inventoryList"></div>
  <div style="text-align:center;margin-top:8px;"><button class="button" onclick="showPanel('')">ÄÃ³ng</button></div>
</div>

<div id="shopPanel" class="panel hidden">
  <h3>ğŸª Shop</h3>
  <div style="text-align:center;margin-bottom:8px;">ğŸª™ Xu: <span id="goldDisplayShop"></span> | ğŸ’¸ USD: <span id="diamondDisplayShop"></span></div>
  <div id="shopContainer"></div>
  <div style="text-align:center;margin-top:8px;"><button class="button" onclick="showPanel('')">ÄÃ³ng</button></div>
</div>
    <div id="forgePanel" class="panel hidden"><h3>âš’ï¸ LÃ² rÃ¨n</h3><div id="forgeArea"></div><div style="text-align:center;margin-top:8px;"><button class="button" onclick="showPanel('')">ÄÃ³ng</button></div></div>
    <div id="skillPanel" class="panel hidden"><h3>ğŸ“’ Ká»¹ nÄƒng</h3><div id="skillContainer"></div><div style="text-align:center;margin-top:8px;"><button class="button" onclick="showPanel('')">ÄÃ³ng</button></div></div>
</div>

<div id="createCharacterModal" class="panel hidden" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;padding:20px;border: 2px solid #2196f3;">
  <h3>ğŸ†• Táº¡o NhÃ¢n Váº­t Má»›i</h3>
  <p>TÃªn nhÃ¢n váº­t:</p>
  <input type="text" id="charNameInput" value="Anh hÃ¹ng" style="width: 90%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">
  <p>Chá»n giá»›i tÃ­nh/Icon:</p>
  <select id="charGenderSelect" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 15px;">
    <option value="1">ğŸ™â€â™‚ï¸ Nam</option>
    <option value="2">ğŸ™â€â™€ï¸ Ná»¯</option>
  </select>
  <div style="display: flex; justify-content: space-between;">
    <button class="button" onclick="confirmCreateCharacter()">Táº¡o</button>
    <button class="button" style="background:#f44336;" onclick="document.getElementById('createCharacterModal').classList.add('hidden')">Há»§y</button>
  </div>
</div>
<div class="panel" style="margin-top:12px;"><div id="battleControls" style="text-align:center;"></div><div id="log"></div><div class="row" style="margin-top:8px;">
  <button class="button" onclick="showPanel('inventoryPanel')">ğŸ’ 3 lÃ´</button>
  <button class="button" onclick="showPanel('skillPanel')">ğŸ“’ Kill</button>
  <button class="button" onclick="showPanel('forgePanel')">âš’ï¸ LÃ² rÃ¨n</button>
  </div>
  </div>
<footer>Sá»­a lá»—i, cáº­p nháº­t... LH Zalo: 0868600865.</footer>
<script>
let player=null,gold=0,diamonds=0,enemy=null,battleActive=false;
let pet={key:null,name:'ğŸ¾ ChÆ°a cÃ³',displayName:'ChÆ°a cÃ³ thÃº cÆ°ng',level:0,love:0};
let farm={plots:[{seed:null,plantedAt:null}],seeds:0,storage:{}, shownSeedHint: false};
let fruits={chestnut:0,coconut:0,appleGreen:0,appleRed:0,bamboo:0,flower:0};

function log(t){
  const l=document.getElementById('log');
  l.insertAdjacentHTML('beforeend',`<div>${t}</div>`);
  while(l.children.length>100) l.removeChild(l.firstChild);
  l.scrollTop=l.scrollHeight;
}
function saveGame(){
  const save={player,gold,diamonds,pet,farm,fruits};
  localStorage.setItem('miniRPG2_save',JSON.stringify(save));
  log('ğŸ’¾ ÄÃ£ lÆ°u game.');
}
function loadGame(){
  const raw=localStorage.getItem('miniRPG2_save');
  if(!raw)return;
  try{
    const obj=JSON.parse(raw);
    player=obj.player||player;
    gold=obj.gold||gold;
    diamonds=obj.diamonds||diamonds;
    pet=obj.pet||pet;
    
    farm=obj.farm||farm;
    if (typeof farm.shownSeedHint === 'undefined') {
        farm.shownSeedHint = false;
    }
    if (player && typeof player.icon === 'undefined') {
        player.icon = player.class === 'Female' ? 'ğŸ™â€â™€ï¸' : 'ğŸ™â€â™‚ï¸'; 
    }


    fruits=obj.fruits||fruits;
    log('ğŸ”„ Dá»¯ liá»‡u Ä‘Ã£ táº£i.');
  }catch(e){console.error(e);log('âš ï¸ KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u!');}
  updateUI();
  renderAll();
  updateGameControls();
}

function updateGameControls() {
  const createBtn = document.getElementById('createBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const saveBtn = document.getElementById('saveBtn');

  if (player) {
    createBtn && createBtn.classList.add('hidden');
    deleteBtn && deleteBtn.classList.remove('hidden');
    saveBtn && saveBtn.classList.remove('hidden');
  } else {
    createBtn && createBtn.classList.remove('hidden');
    deleteBtn && deleteBtn.classList.add('hidden');
    saveBtn && saveBtn.classList.add('hidden');
  }
}

function showPanel(id){
  document.querySelectorAll('#mainPanels > div').forEach(d=>d.classList.add('hidden'));
  document.getElementById('farmPanel').classList.add('hidden'); 
  
  if(id){
      const panel = document.getElementById(id);
      if(panel) {
          panel.classList.remove('hidden');
      }
  }
  renderAll();
}

function updateUI(){
  if(!player){
    document.getElementById('characterInfo').innerHTML='<em>ChÆ°a cÃ³ nhÃ¢n váº­t</em>';
    document.getElementById('characterIcon').textContent='â“';
    document.getElementById('hpBar').style.width='0%';
    document.getElementById('mpBar').style.width='0%';
    document.getElementById('expBar').style.width='0%';
    
    const goldEls = [document.getElementById('goldDisplay'), document.getElementById('goldDisplayShop')];
    const diaEls = [document.getElementById('diamondDisplay'), document.getElementById('diamondDisplayShop')];

    goldEls.forEach(el => el && (el.textContent = gold));
    diaEls.forEach(el => el && (el.textContent = diamonds));
    
    return;
  }
  
  document.getElementById('characterInfo').innerHTML =
  `ğŸ˜€ <b>${player.name}</b> | Lv ${player.level} | ğŸ’ª ${player.power}`;

  document.getElementById('hpBar').style.width=((player.health/player.maxHealth)*100)+'%';
  document.getElementById('mpBar').style.width=((player.mp/player.maxMp)*100)+'%';
  document.getElementById('expBar').style.width=Math.min(100,(player.exp/expNeeded(player.level))*100)+'%';
  
  const icon=player.icon || 'â“';
  document.getElementById('characterIcon').textContent=icon;

  const goldEls = [document.getElementById('goldDisplay'), document.getElementById('goldDisplayShop')];
  const diaEls = [document.getElementById('diamondDisplay'), document.getElementById('diamondDisplayShop')];

  goldEls.forEach(el => el && (el.textContent = gold));
  diaEls.forEach(el => el && (el.textContent = diamonds));
}

function expNeeded(lv) {
  return lv * 100;
}

function showStatValue(type) {
  if (!player) {
    log("âš ï¸ Báº¡n chÆ°a cÃ³ nhÃ¢n váº­t!");
    return;
  }

  let message = '';
  switch (type) {
    case 'hp':
      message = `â¤ï¸ HP: ${player.health} / ${player.maxHealth}`;
      break;
    case 'mp':
      message = `ğŸ”‹ MP: ${player.mp} / ${player.maxMp}`;
      break;
    case 'exp':
      const needed = expNeeded(player.level);
      const percent = Math.min(100, (player.exp / needed) * 100).toFixed(2);
      message = `âœ¨ EXP: ${player.exp} / ${needed} (${percent}%)`;
      break;
    default:
      return;
  }
  
  log(`[ThÃ´ng sá»‘]: ${message}`);
}
// ÄÃƒ Sá»¬A: HÃ m createCharacter chá»‰ má»Ÿ modal
function createCharacter(){
  if (player) {
    log("âš ï¸ ÄÃ£ cÃ³ nhÃ¢n váº­t. Vui lÃ²ng xÃ³a nhÃ¢n váº­t cÅ© trÆ°á»›c!");
    return;
  }
  document.getElementById('createCharacterModal').classList.remove('hidden');
}

// HÃ€M Má»šI: Xá»­ lÃ½ logic táº¡o nhÃ¢n váº­t tá»« modal
function confirmCreateCharacter() {
  const name = document.getElementById('charNameInput').value;
  const genderChoice = document.getElementById('charGenderSelect').value;

  if (!name || name.trim() === '') {
    log('âš ï¸ TÃªn nhÃ¢n váº­t khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng!');
    return;
  }
  
  document.getElementById('createCharacterModal').classList.add('hidden');
  
  let className = 'Novice'; 
  let icon = 'â“'; 

  if (genderChoice === '1') {
      className = 'Male';
      icon = 'ğŸ™â€â™‚ï¸';
  } else if (genderChoice === '2') {
      className = 'Female';
      icon = 'ğŸ™â€â™€ï¸';
  } else {
      className = 'Male';
      icon = 'ğŸ™â€â™‚ï¸';
  }

  localStorage.removeItem('miniRPG2_save');
  localStorage.removeItem('miniRPG2_lastClaim');

  const weapon = 'Stick'; 

  player = {
    name,
    class: className,
    level: 1,
    basePower: 10,
    baseMaxHealth: 100,
    health: 100,
    maxHealth: 100,
    mp: 50,
    maxMp: 50,
    exp: 0,
    equipment: [{ type: weapon, level: 1, equipped: true }],
    icon: icon
  };

  player.power = player.basePower * player.level;
  gold = 0; 
  diamonds = 0; 
  
  farm={plots:[{seed:null,plantedAt:null}],seeds:0,storage:{}, shownSeedHint: false};
  fruits={chestnut:0,coconut:0,appleGreen:0,appleRed:0,bamboo:0,flower:0};

  updateUI();
  renderAll();
  updateGameControls(); 
  log('âœ… NhÃ¢n váº­t má»›i Ä‘Ã£ táº¡o!');
  log('ğŸ Pháº§n thÆ°á»Ÿng Online Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t láº¡i, báº¡n cÃ³ thá»ƒ nháº­n láº¡i tá»« hÃ´m nay!');
}
// END HÃ€M Sá»¬A Lá»–I

function deleteCharacter(){
  if (!confirm('XÃ³a toÃ n bá»™ dá»¯ liá»‡u?')) return;
  localStorage.removeItem('miniRPG2_save');
  localStorage.removeItem('miniRPG2_lastClaim');

  player = null;
  gold = 0;
  diamonds = 0;
  farm={plots:[{seed:null,plantedAt:null}],seeds:0,storage:{}, shownSeedHint: false};
  fruits={chestnut:0,coconut:0,appleGreen:0,appleRed:0,bamboo:0,flower:0};
  
  updateUI();
  updateGameControls(); 
  
  document.getElementById('log').innerHTML = '';
  log('ğŸ—‘ï¸ Dá»¯ liá»‡u Ä‘Ã£ xÃ³a.');
}
function claimDailyReward() {
  if (!player) {
    log("âš ï¸ Báº¡n chÆ°a cÃ³ nhÃ¢n váº­t!");
    return;
  }
  const today = new Date().toISOString().split('T')[0];
  const last = localStorage.getItem('miniRPG2_lastClaim');

  if (last === today) {
    log('ğŸ Báº¡n Ä‘Ã£ nháº­n quÃ  hÃ´m nay rá»“i, quay láº¡i vÃ o ngÃ y mai nhÃ©!');
    return;
  }

  const goldReward = 100; 
  const diamondReward = 10; 

  gold += goldReward;
  diamonds += diamondReward;

  localStorage.setItem('miniRPG2_lastClaim', today);

  updateUI();
  log(`ğŸ Báº¡n nháº­n Ä‘Æ°á»£c ${goldReward} Xu vÃ  ${diamondReward} USD tá»« pháº§n thÆ°á»Ÿng Online hÃ´m nay!`);
  saveGame();
}

function renderAll() {
  function renderFarm() {
    const farmArea = document.getElementById('farmArea');
    if (!farmArea) return;
    farmArea.innerHTML = '';
    
    if (!farm.shownSeedHint && farm.seeds === 0 && diamonds >= 10) { // Sá»­a giÃ¡ 5 thÃ nh 10
      log("Gá»£i Ã½: HÃ£y mua háº¡t giá»‘ng Ä‘á»ƒ báº¯t Ä‘áº§u trá»“ng trá»t!");
      farm.shownSeedHint = true; 
      saveGame(); 
    }
    
    farm.plots.forEach((plot, index) => {
      let content = 'Trá»‘ng (Click Ä‘á»ƒ trá»“ng)';
      let className = 'empty';
      let action = `harvestPlot(${index})`; 
      
      if (plot.seed) {
        const timeToGrow = 10000;
        const isReady = (Date.now() - plot.plantedAt) > timeToGrow; 
        
        if (isReady) {
            content = 'Sáºµn sÃ ng thu hoáº¡ch (Click!)';
            className = 'ready';
        } else {
            const progress = (Date.now() - plot.plantedAt) / timeToGrow;
            const remaining = Math.ceil(timeToGrow/1000 - (Date.now() - plot.plantedAt) / 1000);
            content = `Äang lá»›n... (${Math.floor(progress*100)}% | ${remaining}s)`;
            className = 'growing';
        }
      }
      farmArea.innerHTML += `<div class="plot ${className}" onclick="${action}">${content}</div>`;
    });
  }
  
  if (document.getElementById('farmPanel') && !document.getElementById('farmPanel').classList.contains('hidden')) {
    renderFarm();
  }
  if (document.getElementById('inventoryPanel') && !document.getElementById('inventoryPanel').classList.contains('hidden')) {
    document.getElementById('inventoryList').innerHTML = `<div class="item-row">Háº¡t Dáº» (ğŸŒ°) <span>x${fruits.chestnut}</span></div>
                                                         <div class="item-row">Háº¡t Giá»‘ng <span>x${farm.seeds}</span></div>`;
  }
}

function gainExp(amount) {
  if (!player) return;
  player.exp += amount;
  log(`âœ¨ Nháº­n ${amount} EXP`);

  while (player.exp >= expNeeded(player.level)) {
    player.exp -= expNeeded(player.level);
    player.level++;
    player.maxHealth += 20;
    player.health = player.maxHealth;
    player.maxMp += 10;
    player.mp = player.maxMp;
    player.power += 5;
    log(`ğŸ†™ LÃªn cáº¥p ${player.level}! â¤ï¸ Há»“i Ä‘áº§y mÃ¡u + ğŸ”‹ Há»“i Ä‘áº§y mana + ğŸ’ª tÄƒng sá»©c máº¡nh!`);
  }

  updateUI();
  saveGame();
}

function harvestPlot(index) {
  if (!player) {
    log("âš ï¸ Báº¡n chÆ°a cÃ³ nhÃ¢n váº­t!");
    return;
  }
  
  const plot = farm.plots[index];
  
  if (plot.seed) {
    const timeToGrow = 10000; 
    const isReady = (Date.now() - plot.plantedAt) > timeToGrow;
    
    if (isReady) {
      const fruit = 'chestnut';
      fruits[fruit] = (fruits[fruit] || 0) + 1;
      log(`ğŸŒ° Thu hoáº¡ch thÃ nh cÃ´ng 1 háº¡t dáº»!`);
      farm.plots[index] = { seed: null, plantedAt: null };
      saveGame();
      renderAll();
    } else {
      const remaining = Math.ceil((timeToGrow - (Date.now() - plot.plantedAt)) / 1000);
      log(`â³ CÃ¢y chÆ°a lá»›n xong, cÃ²n ${remaining} giÃ¢y!`);
    }
  } else {
    if (farm.seeds > 0) {
      farm.seeds--;
      plot.seed = 'chestnutSeed';
      plot.plantedAt = Date.now();
      log("ğŸŒ± ÄÃ£ trá»“ng háº¡t dáº»!");
      saveGame();
      renderAll();
    } else {
      log("âš ï¸ Báº¡n khÃ´ng cÃ³ háº¡t giá»‘ng! Mua háº¡t á»Ÿ nÃºt bÃªn dÆ°á»›i.");
    }
  }
}

function buySeed() { 
  if (!player) {
    log("âš ï¸ Báº¡n chÆ°a cÃ³ nhÃ¢n váº­t!");
    return;
  }
  const seedPrice = 10;
  if (diamonds >= seedPrice) {
    diamonds -= seedPrice;
    farm.seeds += 1;
    log("ğŸ«˜ ÄÃ£ mua 1 háº¡t giá»‘ng!");
    updateUI();
    saveGame();
    renderAll();
  } else {
    log(`ğŸ’¸ KhÃ´ng Ä‘á»§ ${seedPrice} USD!`);
  }
}
function buyPlot() { 
  if (!player) {
    log("âš ï¸ Báº¡n chÆ°a cÃ³ nhÃ¢n váº­t!");
    return;
  }
  const plotPrice = (farm.plots.length + 1) * 50;
  if (gold >= plotPrice) {
    gold -= plotPrice;
    farm.plots.push({seed:null, plantedAt:null});
    log(`ğŸª™ ÄÃ£ mua Ã´ Ä‘áº¥t má»›i vá»›i giÃ¡ ${plotPrice} Xu!`);
    updateUI();
    saveGame();
    renderAll();
  } else {
    log(`ğŸª™ KhÃ´ng Ä‘á»§ ${plotPrice} Xu Ä‘á»ƒ mua Ã´ Ä‘áº¥t má»›i!`);
  }
}

function startBattle() { log("ğŸŒ Chá»©c nÄƒng chá»n báº£n Ä‘á»“ chÆ°a Ä‘Æ°á»£c triá»ƒn khai."); }

window.addEventListener('load',()=>{
  loadGame();
  setInterval(renderAll, 1000);
});
</script>
</body></html>
